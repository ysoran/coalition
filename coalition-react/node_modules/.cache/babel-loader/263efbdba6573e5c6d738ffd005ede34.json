{"ast":null,"code":"var _jsxFileName = \"/Users/yasarsoran/Documents/coalition-project/coalition-react/src/components/sign-up/sign-up.tsx\";\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Button, Grid, TextField } from '@material-ui/core';\nimport styled from 'styled-components';\nimport axios from 'axios';\nconst StyledInformation = styled.div`\n    padding: 20px;\n    border: 1px solid #aaa;\n    text-align: left;\n    background-color:#eee;\n`;\nconst StyledContainer = styled.div`\n    padding:30px;\n`;\nconst StyledWarning = styled.div`\n    padding:20px;\n    border: 1px solid #aaa;\n    background-color: orange;\n`;\nconst StyledWarningEmail = styled.div`\n    padding:20px;\n    border: 1px solid #aaa;\n    background-color: red;\n    color: white;\n`;\n\nconst SignUp = props => {\n  const [firstname, setFirstname] = useState('');\n  const [lastname, setLastname] = useState('');\n  const [email, setEmail] = useState('');\n  const [address, setAddress] = useState('');\n  const [signuptried, setSignuptried] = useState(false);\n  const [fieldsWarning, setFieldsWarning] = useState('');\n  const [emailWarning, setEmailWarning] = useState('');\n  const [domainWhiteList, setDomainWhiteList] = useState({});\n  const [agencyData, setAgencyData] = useState({});\n  useEffect(() => {\n    axios.get(\"http://127.0.0.1:5000/domain-whitelist\").then(data => {\n      setDomainWhiteList(data);\n    });\n    axios.get(\"http://127.0.0.1:5000/agency\").then(data => {\n      setAgencyData(data);\n    });\n  }, [props]);\n\n  const resetWarnings = () => {\n    setFieldsWarning('');\n    setEmailWarning('');\n  };\n\n  const validateFields = useCallback(() => {\n    let isValid = true;\n    resetWarnings();\n    [firstname, lastname, email, address].forEach(each => {\n      if (!each || each === '') {\n        isValid = false;\n        setFieldsWarning('Please make sure you filled all fields');\n      }\n    });\n    if (!isValid) return isValid;\n\n    if (!/^[a-zA-Z0-9]+@[a-zA-Z0-9]+\\.[A-Za-z]+$/.test(email)) {\n      isValid = false;\n      setEmailWarning('Please enter a valid email address');\n      return isValid;\n    }\n\n    return isValid;\n  }, [firstname, lastname, email, address]);\n\n  const validateDomain = () => {\n    let isValid = false;\n    let domain = email.split(\"@\")[1];\n    domainWhiteList.data.forEach(each => {\n      if (each.domain === domain) {\n        isValid = true;\n      }\n    });\n    return isValid;\n  };\n\n  const degreesToRadians = degrees => {\n    var pi = Math.PI;\n    return degrees * (pi / 180);\n  };\n\n  const calculateDistance = (lat1, lon1, lat2, lon2) => {\n    let x = degreesToRadians(lon1 - lon2) * Math.cos(degreesToRadians((lat1 + lat2) / 2));\n    let y = degreesToRadians(lat1 - lat2);\n    let dist = Math.sqrt(x * x + y * y); //* 6371000.0 earth radius to calculate real distance\n\n    return dist;\n  };\n\n  const findClosestAgency = async () => {\n    let position = [];\n    let currentPosition;\n    let distance = {};\n    await axios.get(\"https://geocode.search.hereapi.com/v1/geocode?q=\" + address + \"&apiKey=Im--khLHbBA8JRRkbOwDxenOy3ksxLIGy8gMnJFhh7M\").then(result => {\n      if (result.data.items && result.data.items.length > 0) {\n        currentPosition = result.data.items[0].position;\n      }\n    });\n\n    for (let i = 0; i < agencyData.data.length; i++) {\n      await axios.get(\"https://geocode.search.hereapi.com/v1/geocode?q=\" + agencyData.data[i].agency_address + \"&apiKey=Im--khLHbBA8JRRkbOwDxenOy3ksxLIGy8gMnJFhh7M\").then(result => {\n        if (result.data.items && result.data.items.length > 0) {\n          position[agencyData.data[i].id] = result.data.items[0].position;\n        }\n      });\n    }\n\n    let distanceId = 0;\n    position.forEach(currentTarget => {\n      distance[distanceId] = calculateDistance(currentPosition.lat, currentPosition.lng, currentTarget.lat, currentTarget.lng);\n      distanceId++;\n    });\n    let closest = Number.MAX_SAFE_INTEGER;\n    let closestId;\n    Object.keys(distance).forEach(each => {\n      if (distance[each] < closest) {\n        closest = distance[each];\n        closestId = each;\n      }\n    });\n    return closestId;\n  };\n\n  const assingAgencyId = () => {\n    let domain = email.split(\"@\")[1];\n    let agencyId = -10;\n\n    for (let i = 0; i < agencyData.data.length; i++) {\n      if (agencyData.data[i].domain === domain) {\n        agencyId = agencyData.data[i].id;\n        break;\n      }\n    }\n\n    return agencyId;\n  };\n\n  const handleClick = async () => {\n    setSignuptried(true);\n\n    if (validateFields()) {\n      if (validateDomain()) {\n        let agencyId = assingAgencyId();\n\n        if (agencyId === -10) {\n          agencyId = await findClosestAgency();\n        }\n\n        const headers = {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*'\n        };\n        axios.post(\"http://127.0.0.1:5000/broker\", JSON.stringify({\n          variables: {\n            agency_id: agencyId,\n            firstname: firstname,\n            lastname: lastname,\n            email: email,\n            broker_address: address\n          }\n        }), {\n          headers\n        }).then(response => {\n          if (!response.data.error) {\n            props.changeTab(1);\n          } else {\n            setFieldsWarning(response.data.error);\n          }\n        });\n      } else {\n        setFieldsWarning(\"This domain is not in white list\");\n      }\n    }\n  };\n\n  useEffect(() => {\n    signuptried && validateFields();\n  }, [signuptried, validateFields]);\n\n  const handleChangeFirstname = e => {\n    setFirstname(e.target.value);\n  };\n\n  const handleChangeLastname = e => {\n    setLastname(e.target.value);\n  };\n\n  const handleChangeEmail = e => {\n    setEmail(e.target.value);\n  };\n\n  const handleChangeAddress = e => {\n    setAddress(e.target.value);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(StyledContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    md: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 25\n    }\n  }, fieldsWarning && fieldsWarning !== '' ? /*#__PURE__*/React.createElement(StyledWarning, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 72\n    }\n  }, fieldsWarning) : emailWarning && emailWarning !== '' ? /*#__PURE__*/React.createElement(StyledWarningEmail, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 74\n    }\n  }, emailWarning) : signuptried ? /*#__PURE__*/React.createElement(StyledInformation, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 52\n    }\n  }, \"Form is valid\") : /*#__PURE__*/React.createElement(StyledInformation, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 107\n    }\n  }, \"Please fill the form below to sign up\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: handleChangeFirstname,\n    required: true,\n    id: \"firstname\",\n    label: \"Firstname\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: handleChangeLastname,\n    required: true,\n    id: \"lastname\",\n    label: \"Lastname\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: handleChangeEmail,\n    required: true,\n    id: \"email\",\n    label: \"Email\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: handleChangeAddress,\n    required: true,\n    id: \"address\",\n    label: \"Address\",\n    helperText: \"Enter your address on one line\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    item: true,\n    xs: 12,\n    justify: \"flex-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: handleClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 29\n    }\n  }, \"Sign Up\"))))));\n};\n\nexport default SignUp;","map":{"version":3,"sources":["/Users/yasarsoran/Documents/coalition-project/coalition-react/src/components/sign-up/sign-up.tsx"],"names":["React","useState","useEffect","useCallback","Button","Grid","TextField","styled","axios","StyledInformation","div","StyledContainer","StyledWarning","StyledWarningEmail","SignUp","props","firstname","setFirstname","lastname","setLastname","email","setEmail","address","setAddress","signuptried","setSignuptried","fieldsWarning","setFieldsWarning","emailWarning","setEmailWarning","domainWhiteList","setDomainWhiteList","agencyData","setAgencyData","get","then","data","resetWarnings","validateFields","isValid","forEach","each","test","validateDomain","domain","split","degreesToRadians","degrees","pi","Math","PI","calculateDistance","lat1","lon1","lat2","lon2","x","cos","y","dist","sqrt","findClosestAgency","position","currentPosition","distance","result","items","length","i","agency_address","id","distanceId","currentTarget","lat","lng","closest","Number","MAX_SAFE_INTEGER","closestId","Object","keys","assingAgencyId","agencyId","handleClick","headers","post","JSON","stringify","variables","agency_id","broker_address","response","error","changeTab","handleChangeFirstname","e","target","value","handleChangeLastname","handleChangeEmail","handleChangeAddress"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { Button, Grid, TextField } from '@material-ui/core';\nimport styled from 'styled-components';\nimport axios, { AxiosResponse } from 'axios';\n\ninterface ICreateUserProps {\n    changeTab: (active: any) => void;\n}\n\nconst StyledInformation = styled.div`\n    padding: 20px;\n    border: 1px solid #aaa;\n    text-align: left;\n    background-color:#eee;\n`;\n\nconst StyledContainer = styled.div`\n    padding:30px;\n`;\n\nconst StyledWarning = styled.div`\n    padding:20px;\n    border: 1px solid #aaa;\n    background-color: orange;\n`;\n\nconst StyledWarningEmail = styled.div`\n    padding:20px;\n    border: 1px solid #aaa;\n    background-color: red;\n    color: white;\n`;\n\nconst SignUp = (props: ICreateUserProps) => {\n    const [firstname, setFirstname] = useState('');\n    const [lastname, setLastname] = useState('');\n    const [email, setEmail] = useState('');\n    const [address, setAddress] = useState('');\n    const [signuptried, setSignuptried] = useState(false);\n    const [fieldsWarning, setFieldsWarning] = useState('');\n    const [emailWarning, setEmailWarning] = useState('');\n    const [domainWhiteList, setDomainWhiteList] = useState({} as AxiosResponse<any>);\n    const [agencyData, setAgencyData] = useState({} as AxiosResponse<any>);\n\n    useEffect(() => {\n        axios.get(\"http://127.0.0.1:5000/domain-whitelist\").then((data) => {\n            setDomainWhiteList(data);\n        });\n\n        axios.get(\"http://127.0.0.1:5000/agency\").then((data) => {\n            setAgencyData(data);\n        });\n\n    }, [props]);\n\n\n    const resetWarnings = () => {\n        setFieldsWarning('');\n        setEmailWarning('');\n    }\n\n    const validateFields = useCallback(() => {\n        let isValid = true;\n        resetWarnings();\n        [firstname, lastname, email, address].forEach(\n            (each) => {\n                if (!each || each === '') {\n                    isValid = false;\n                    setFieldsWarning('Please make sure you filled all fields');\n                }\n            }\n        );\n\n        if (!isValid) return isValid;\n\n        if (!/^[a-zA-Z0-9]+@[a-zA-Z0-9]+\\.[A-Za-z]+$/.test(email)) {\n            isValid = false;\n            setEmailWarning('Please enter a valid email address');\n            return isValid;\n        }\n\n        return isValid;\n    }, [firstname, lastname, email, address]);\n\n    const validateDomain = () => {\n        let isValid = false;\n        let domain = email.split(\"@\")[1];\n        domainWhiteList.data.forEach((each: any) => {\n            if (each.domain === domain) {\n                isValid = true;\n            }\n        });\n\n        return isValid;\n    }\n\n    const degreesToRadians = (degrees: number) => {\n        var pi = Math.PI;\n        return degrees * (pi / 180);\n    }\n\n    const calculateDistance = (lat1: number, lon1: number, lat2: number, lon2: number) => {\n        let x = degreesToRadians(lon1 - lon2) * Math.cos(degreesToRadians((lat1 + lat2) / 2));\n        let y = degreesToRadians(lat1 - lat2);\n        let dist = Math.sqrt(x * x + y * y);  //* 6371000.0 earth radius to calculate real distance\n        return dist;\n    }\n\n    const findClosestAgency = async (): Promise<number> => {\n        let position: Array<any> = [];\n        let currentPosition: any;\n        let distance: any = {};\n        await axios.get(\"https://geocode.search.hereapi.com/v1/geocode?q=\" + address + \"&apiKey=Im--khLHbBA8JRRkbOwDxenOy3ksxLIGy8gMnJFhh7M\").then((result) => {\n            if (result.data.items && result.data.items.length > 0) {\n                currentPosition = result.data.items[0].position;\n            }\n        });\n\n        for (let i = 0; i < agencyData.data.length; i++) {\n            await axios.get(\"https://geocode.search.hereapi.com/v1/geocode?q=\" + agencyData.data[i].agency_address + \"&apiKey=Im--khLHbBA8JRRkbOwDxenOy3ksxLIGy8gMnJFhh7M\").then((result) => {\n                if (result.data.items && result.data.items.length > 0) {\n                    position[agencyData.data[i].id] = result.data.items[0].position;\n                }\n            });\n        }\n\n        let distanceId = 0;\n        position.forEach((currentTarget) => {\n            distance[distanceId] = calculateDistance(currentPosition.lat, currentPosition.lng, currentTarget.lat, currentTarget.lng);\n            distanceId++;\n        });\n\n        let closest = Number.MAX_SAFE_INTEGER;\n        let closestId;\n        Object.keys(distance).forEach((each) => {\n            if (distance[each] < closest) {\n                closest = distance[each];\n                closestId = each;\n            }\n        });\n        return closestId;\n    }\n\n    const assingAgencyId = () => {\n        let domain = email.split(\"@\")[1];\n        let agencyId = -10;\n        for (let i = 0; i < agencyData.data.length; i++) {\n            if (agencyData.data[i].domain === domain) {\n                agencyId = agencyData.data[i].id;\n                break;\n            }\n        }\n        return agencyId;\n    }\n\n    const handleClick = async () => {\n        setSignuptried(true);\n        if (validateFields()) {\n            if (validateDomain()) {\n                let agencyId = assingAgencyId();\n                if (agencyId === -10) {\n                    agencyId = await findClosestAgency();\n                }\n                const headers = {\n                    'Content-Type': 'application/json',\n                    'Access-Control-Allow-Origin': '*'\n                };\n                axios.post(\"http://127.0.0.1:5000/broker\", JSON.stringify({\n                    variables: {\n                        agency_id: agencyId,\n                        firstname: firstname,\n                        lastname: lastname,\n                        email: email,\n                        broker_address: address\n                    }\n                }), { headers }).then((response) => {\n                    if (!response.data.error) {\n                        props.changeTab(1);\n                    } else {\n                        setFieldsWarning(response.data.error);\n                    }\n                });\n            } else {\n                setFieldsWarning(\"This domain is not in white list\");\n            }\n        }\n    }\n\n    useEffect(() => { signuptried && validateFields() }, [signuptried, validateFields])\n\n    const handleChangeFirstname = (e: any) => {\n        setFirstname(e.target.value);\n    }\n\n    const handleChangeLastname = (e: any) => {\n        setLastname(e.target.value);\n    }\n\n    const handleChangeEmail = (e: any) => {\n        setEmail(e.target.value);\n    }\n\n    const handleChangeAddress = (e: any) => {\n        setAddress(e.target.value);\n    }\n\n\n    return (\n        <div>\n            <React.Fragment>\n                <StyledContainer>\n                    <Grid container spacing={3}>\n                        <Grid item md={12}>\n                            {(fieldsWarning && fieldsWarning !== '') ? <StyledWarning>{fieldsWarning}</StyledWarning> :\n                                ((emailWarning && emailWarning !== '') ? <StyledWarningEmail>{emailWarning}</StyledWarningEmail> :\n                                    (signuptried ? <StyledInformation>Form is valid</StyledInformation> : <StyledInformation>Please fill the form below to sign up</StyledInformation>)\n                                )}\n                        </Grid>\n                        <Grid item xs={12} md={6}>\n                            <TextField onChange={handleChangeFirstname} required id=\"firstname\" label=\"Firstname\" fullWidth />\n                        </Grid>\n                        <Grid item xs={12} md={6}>\n                            <TextField onChange={handleChangeLastname} required id=\"lastname\" label=\"Lastname\" fullWidth />\n                        </Grid>\n                        <Grid item xs={12} md={6}>\n                            <TextField\n                                onChange={handleChangeEmail}\n                                required\n                                id=\"email\"\n                                label=\"Email\"\n                                fullWidth\n                            />\n                        </Grid>\n                        <Grid item xs={12} md={6}>\n                            <TextField\n                                onChange={handleChangeAddress}\n                                required\n                                id=\"address\"\n                                label=\"Address\"\n                                helperText=\"Enter your address on one line\"\n                                fullWidth\n                            />\n                        </Grid>\n                        <Grid container item xs={12} justify=\"flex-end\">\n                            <Button variant=\"contained\" color=\"primary\" onClick={handleClick}>\n                                Sign Up\n                            </Button>\n                        </Grid>\n                    </Grid>\n                </StyledContainer>\n            </React.Fragment>\n        </div>\n    );\n}\n\nexport default SignUp;"]},"metadata":{},"sourceType":"module"}